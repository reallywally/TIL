# RAG Best Practice

## 들어가며

RAG를 공부하다 보면 기본적은 흐름과 구조는 이해가 되었다. 이제는 단순 RAG 구현을 넘어 실제 프로덕션 환경에서 어떻게 구현하는지 알아보자.

## RAG 시스템의 전체 아키텍처

RAG 시스템은 크게 문서를 인덱싱처리는 단계외 사용자 질문을 처리하는 단계로 구성된다.

```plaintext
┌─────────────────────────────────────────────────────────┐
  Phase 1: 문서 인덱싱 (오프라인)                           
  문서 수집 → 전처리 → 청킹 → 임베딩 → 벡터 DB 저장           
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
  Phase 2: 쿼리 처리 (온라인 - 실시간)                      
                                                      
  사용자 쿼리                                         
       ↓                                              
  1. 쿼리 전처리 & 분석                               
       ↓                                              
  2. 쿼리 확장/재작성                                 
       ↓                                              
  3. 하이브리드 검색 (벡터 + 키워드)                 
       ↓                                              
  4. 리랭킹 (Re-ranking)                              
       ↓                                              
  5. 컨텍스트 압축 & 정리                             
       ↓                                              
  6. 프롬프트 구성                                    
       ↓                                              
  7. LLM 응답 생성                                    
       ↓                                              
  8. 후처리 & 검증                                    
       ↓                                              
  9. 응답 반환 (출처 포함)                            
       ↓                                              
  10. 피드백 수집 & 로깅                              
└─────────────────────────────────────────────────────────┘
```

## Part1: 문서 인덱싱 - 견고한 기반 다지기

### 1. 문서 수집

다양한 문서 형식을 지원 하여 많은 문서를 수집할 수 있도록 하자. 최소한 아래 문서 형식을 지원하고 가능하면 외부 API도 수집되면 좋다.

- 구조화된 문서: PDF, DOCX
- 마크업 문서: HTML, Markdown, XML
- 플레인 텍스트: TXT, CSV, JSON

> 💡 **실전 팁!**  
> 데이터 수집시 메타데이터는 나중에 검색 필터링, 출처 표시 등 다양한 부분에서 활용되니 반드시 보존하자.
>
> ```python
> metadata = {
>     'source': 'https://example.com/doc.pdf',
>     'title': '제품 사용 가이드',
>     'author': 'Hong Gildong',
>     'created_at': '2024-10-01',
>     'version': '2.0',
>     'document_type': 'manual'
> }
> ```

### 2. 문저 전처리 - 노이즈 제거

원본 문서는 종종 불필요한 요소를 포함한다. 깔끔한 전처리가 임베딩 품질을 크게 좌우한다.

#### 전처리 체크리스트

1. 인코딩(가능하면 UTF-8로 통일)
2. HTML 태그 제거(웹 문서의 경우)
3. 과도한 공백, 줄바꿈 정리
4. 헤더, 푸터, 광고 영역 등 본문과 상관 없는 영역 제거
5. 표와 이미지 처리
