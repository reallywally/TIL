# swap 메모리

## swap 메모리란

실제 RAM이 가득찼지만 더 많은 메모리가 필요할때 디스크 공간을 이용하여 부족한 메모리를 대체하는것이다.

## 확인하는 방법

서버에서 명령어로 free -h 또는 htop으로 확인할 수 있다.

## 얼만큼 지정해야 좋을까

swap 메모리 크기는 시스템의 RAM 크기와 사용 목적에 따라 다르게 설정해야 한다.
Ubuntu 서버 기준 아래와 같다.

- 메모리 부족을 대비한 보조 용도 → 4~8GB 정도로 충분
- Hibernate (절전/디스크 대기 모드) 사용 시 → RAM 크기와 동일 이상 필요
- 메모리 넉넉 (64GB 이상) → 2~4GB만 확보하거나 필요 시 제거해도 무방
- DB 서버 / AI 서버 / 대용량 메모리 서버 → Swap 거의 안 씀 또는 최소화 (swappiness=1)

## 실제 메모리가 비어있으면 swap 메모리도 여유가 있을까?

**아니다. 실제 메모리가 비어있어도 swap 메모리가 사용될 수 있다.**

### 이유

1. **메모리 관리의 효율성**: Linux는 메모리를 효율적으로 사용하기 위해 자주 사용되지 않는 익명 페이지(anonymous pages)를 swap으로 이동시킨다.

2. **페이지 회수의 평등성**: swap은 "응급 메모리"가 아니라 메모리 회수를 공평하게 만드는 메커니즘이다. 파일 캐시와 익명 페이지 모두 동등하게 회수 대상이 된다.

3. **파일 캐시 우선순위**: 시스템은 자주 사용되지 않는 프로그램 데이터를 swap으로 이동시키고, 대신 파일 캐시를 위해 메모리를 사용한다.

### 실제 상황 예시

- 프로그램 시작 시 많은 메모리를 할당했지만 실제로는 적게 사용하는 경우
- 오랫동안 접근하지 않은 프로그램 메모리가 있는 경우
- 시스템이 파일 I/O 성능을 위해 디스크 캐시를 늘리려고 할 때

이는 정상적인 동작이며, 시스템 성능을 향상시키는 메커니즘이다.

## 초기화 하는 방법

swap 메모리를 초기화(비우기)하는 방법은 다음과 같다.

### 기본 방법

```bash
# 1. 모든 swap 비활성화
sudo swapoff -a

# 2. swap 다시 활성화
sudo swapon -a
```

### 주의사항

- 충분한 물리 메모리: 현재 사용 중인 swap 크기보다 많은 여유 RAM이 있어야 함
- 시스템 안정성: 메모리 부족 시 시스템이 불안정해질 수 있음
