# 폐쇄망에 파이썬 가상환경 사용하기

폐쇄망은 외부 인터넷 연결이 안되서 필요한 프로그램을 미리 준비하고 보안 검사까지 끝내야 사용이 가능하다. 이번 글은 폐쇄망에 파이썬 프로젝트를 진행하면서 필요한 패키지를 준비하는 과정을 정리해 본다.

## 순서

### Step1. 외부망에서 라이브러리 휠(.whl) 파일 추출

```bash
pip freeze > requirements.txt

pip download -r requirements.txt -d ./packages
```

### Step 2. 폐쇄망으로 파일 이동

- requirements.txt 파일
- packages 폴더
- Python 설치 파일 (아직 설치 안 했다면)

### Step3. 폐쇄망에서 가상환경 생성 및 설치

```bash
python -m venv venv

.\venv\Scripts\activate

pip install --no-index --find-links=./packages -r requirements.txt
```

## 궁금했던거

### venv를 압축해서 이동하면 그대로 사용가능한가?

시도해보니 가능은 하지만 정석적인 방법이 아니다. 기본적으로 VSCode에서 복사된 venv를 인터프리터로 인식하지 못한다.
억지로 VSCode가 인식하게 할려면 ```python -m venv ./venv```로 가상환경을 새로 만들고 가져온 venv안에 폴더들을 붙여넣기 해야했다.
그런데 인식은 하더라도 실행할때 깨저서 실행이 안되는 경우도 있었다.
그냥 정석대로 하는걸 권장한다.

### 우분투랑 록키는 같은 리눅스니까 동일한 설치파일을 사용해도 될까?

일반적으로 사용 가능하지만, 주의가 필요하다.

#### 가능한 경우

- 순수 Python 코드로만 구성
- C 확장이나 바이너리가 없는 경우
- 파일명에 py3-none-any.whl 같은 표시

#### 문제가 될 수 있는 경우

C 확장을 포함한 패키지는 호환성 문제가 발생할 수 있다.

- glibc 버전 차이
- 시스템 라이브러리 의존성
- ABI 호환성

Pure Python이면 OK, C 확장 포함이면 테스트 필요하며, 프로덕션 환경에서는 타겟 시스템에서 직접 빌드하는 것을 권장한다.
